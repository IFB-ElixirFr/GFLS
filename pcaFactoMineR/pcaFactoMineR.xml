<tool id="pcaFactoMineR" name="PCAFactoMineR" version="2017-08-24">

	<description> PCA using FactoMineR package</description>
    
  	<requirements>
		<requirement type="binary"> R </requirement>
	</requirements>

	<command interpreter="Rscript">

                pcaFactoMineR_galaxy.R

                datafile $datafile
                samplemetadata $samplemetadata
                npc $npc
                #if str( $condPlot.plotOptions ) == "yes":
                  plotev $condPlot.plotev
                  plotcontrib $condPlot.plotcontrib
                  plotindiv $condPlot.condScore.plotindiv
                  #if str( $condPlot.condScore.plotindiv ) == "yes":
                    colorfactor $condPlot.condScore.condColor.colorfactor
                    #if str( $condPlot.condScore.condColor.colorfactor ) == "yes":
                      factor $condPlot.condScore.condColor.factor
                    #else :
                      factor "None"
                    #end if
                  #else :
                    colorfactor yes
                    factor "None"
                  #end if
                  plotvar $condPlot.condLoading.plotvar
                  #if str( $condPlot.condLoading.plotvar ) == "yes":
                    contribh $condPlot.condLoading.contribh
                    contribv $condPlot.condLoading.contribv
                  #else :
                    contribh 0
                    contribv 0
                  #end if
                #else :
                  plotev yes
                  plotcontrib yes
                  plotindiv yes
                  colorfactor no
                  factor "None"
                  plotvar yes
                  contribh 0
                  contribv 0
                #end if

                #if str( $condGraphical.graphicalOptions ) == "yes":
                  title $condGraphical.title
                  pch $condGraphical.pch
                  pcv $condGraphical.pcv
                  tc $condGraphical.tc
                #else :
                  title "PCA" 
                  pch 1
                  pcv 2
                  tc 1
                #end if
                varinline $varinline

                ## Outputs
                logOut $logOut
                outgraphpdf $outgraphpdf

	</command>

  <inputs>

    <param name="datafile" type="data" label="Data matrix" help="First column is a qualitative variable" format="tabular,csv" />
    <param name="samplemetadata" type="data" label="Biological Factors" help="File with Biological Factor(s)" format="tabular,csv" />

    <param name="npc" label="Number of principal components" type="integer" value="2" min="2" help=""/>

    <conditional name="condPlot">
        <param name="plotOptions" type="select" label="Plot Options" help="If no, it will create the 4 plot and take the default parameters">
            <option value="no" selected="true">No</option>
            <option value="yes">Yes</option>
        </param>
        <when value="yes">

            <param name="plotev" type="select" label="Eigenvalue plot" help="Eigenvalue and percentage of explained variance plots" >
                <option value="yes" selected="true" > Yes </option>
                <option value="no"> No </option>
            </param>

            <param name="plotcontrib" type="select" label="Contribution plot" help="" >
                <option value="yes" selected="true" > Yes </option>
                <option value="no"> No </option>
            </param>

            <conditional name="condScore">
                <param name="plotindiv" label="Score plot" type="select" help="" >
                    <option value="yes" selected="true" > Yes </option>
                    <option value="no"> No </option>
                </param>
                <when value="yes">

                    <conditional name="condColor">
                        <param name="colorfactor" label="Factor color" type="select" help="Colouring of observations according to levels of qualitative variable (biological factor of interest)" >
                            <option value="no" selected="true" > No </option>
                            <option value="yes"> Yes </option>
                        </param>
                        <when value="yes">
  ctoMineR.xml                           <param name="factor" label="Name of the column of the data matrix corresponding to the qualitative variable" type="text" value="None" help=""/>
                        </when>
                        <when value="no"></when>
                    </conditional>

                </when>
                <when value="no"></when>
            </conditional>

            <conditional name="condLoading">
                <param name="plotvar" label="Loading plot" type="select" help="">
                    <option value="yes" selected="true" > Yes </option>
                    <option value="no"> No </option>
                </param>
                <when value="yes">          
                    <param name="contribh" label="Contribution threshold (abscissa)" type="float" value="0" help="Contribution threshold for loading plot (Principal component displayed in the abscissa axis)"/>
                    <param name="contribv" label="Contribution threshold (ordinate)" type="float" value="0" help="Contribution threshold for loading plot (Principal component displayed in the ordinate axis)" />
                </when>
                <when value="no"></when>
            </conditional>

        </when>
        <when value="no"></when>
    </conditional>


    <conditional name="condGraphical">
        <param name="graphicalOptions" type="select" label="GraphicalOptions" help="If not, it will take the default parameters">
            <option value="no" selected="true">No</option>
            <option value="yes">Yes</option>
        </param>
        <when value="yes">

            <param name="title" type="text" label="Title" help="Title printed on all plots; if none, leave 'PCA'" value="PCA" />

            <param name="pch" label="Horizontal Principal Component" type="integer" value="1" help="Principal component displayed on the abscissa" />

            <param name="pcv" label="Vertical Principal Component" help="Principal component displayed on the ordinate" type="integer" value="2" />

            <param name="tc" label="Numeric character expansion factor" type="float" value="1.0" min="0.5" help="A value greater than 1 increases and a value lower than 1 decreases character size"/>

        </when>
        <when value="no"></when>
    </conditional>

        <param name="varinline" type="select" multiple="false" display="radio" label="Variable in line or column?">
            <option value="yes">Line</option>
            <option value="no">Column</option>
        </param>

  </inputs>
  
  <outputs>
    <data name="logOut" format="html" label="${tool.name}.log" />
    <data name="outgraphpdf" label="${tool.name}_graph" format="pdf" />
  </outputs>

	<stdio>
	     <exit_code range="1:" level="fatal" />
	</stdio>
    
	<help>
	
.. class:: infomark

**Authors** Sandrine Laguerre (laguerre@insa-toulouse.fr), J.F Martin (jean-francois.martin@inra.fr), M. Tremblay-Franco (marie.tremblay-franco@inra.fr) and V. Marcon (valentin.marcon@inra.fr)


---

Version Galaxy Tool : V1.0


---

Contacts : sigenae-support@listes.inra.fr

E-learning available : Not yet.

Please cite :
    
    Depending on the help provided you can cite us in acknowledgements, references or both.
    
    Examples :
    Acknowledgements
    We wish to thank the SIGENAE group for ....
    
    References
    X. SIGENAE [http://www.sigenae.org/]


===
PCA
===

-----------
Description
-----------

Principal Component Analysis (PCA) as done in the FactoMineR package
 

-----------
Input files
-----------

+---------------------------+------------+
| Parameter : num + label   |   Format   |
+===========================+============+
| 1 : data matrix           |   tabular  |
+---------------------------+------------+

----------
Parameters
----------

Data matrix
	| see "Input files" section above
	| 

Scaling method
	| Standardisation to apply to the variables
	| None, Unit variance (default value) or Pareto scaling
	|

Number of principal component
	| How many principal components include in the PCA model?
	|

(?)Plot options
        | Show (or not) more options for the plots
        |

Eigenvalue plot
	| Eigenvalue and percentage of explained variance plots. Default value is "Yes"
	|

Contribution plot
	| Contribution plot. Default value is "Yes"
	|

Score plot
	| Score plot" plot. Default value is "Yes"
	|

Factor color	
	| Colouring of observations. Default value is "Yes"
	|

Factor
	| Name of the column containing the biological factor (qualitative variable) to color observations according to levels of this
	|

Loading plot
	| Loading plot. Default value is "Yes"
	|

Contribution threshold (abscissa)
	| Contribution threshold for loading plot: principal component displayed in the abscissa axis
	|

Contribution threshold (ordinate)
	| Contribution threshold for loading plot: principal component displayed in the ordinate axis
	|

(?)Graphical options
        | Show (or not) more graphical options
        |

Title
	| Title printed on all plots; if none, leave 'PCA'" value="PCA"
	|

Numeric character expansion factor 
	| A value greater than 1 increases and a value lower than 1 decreases character size
	|

Horizontal Principal Component
	| Principal component displayed on the abscissa
	|

Vertical Principal Component
	| Principal component displayed on the ordinate
	|

------------
Output files
------------

PCAFactoMineR_graph (pdf output)
	| 

PCAFactoMineR_log 
	| 

    </help>

</tool>
